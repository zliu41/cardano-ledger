\section{UTxO}
\label{sec:utxo}

\subsection{Transaction Body Changes}

In $\TxBody$, replace

\[\fun{reqSignerHashes} \in \powerset{\KeyHash} \]

with

\[ \fun{reqSignerHash} \in \type{Hash} \]

Which is a hash of the set of keys in the map of keys to their signatures.
For old style Alonzo transactions submitted in this this new era,
$\fun{reqSignerHash}$ can be constructed from the wire-transmitted $\fun{reqSignerHashes}$
at deserialization time. For an Alonzo-style transaction to be valid in this new era,
all the non-collateral keys that sign must be listed in $\fun{reqSignerHashes}$.

Also, in $\fun{txwits}$, add the field

\[\fun{collateralSigs} \in (\VKey \mapsto \Sig)\]

Note that there may be duplicate key-signature pairs in $\txwitsVKey{tx}$
and $\fun{collateralSigs}豇ぎ族泔蹯痫翦铘獒祆镳糸黹桢蝈狒翳寐弦孱泔溟铉戾鲥麸狯镩漉痨殂狒轱町荏踱箦泗轱铥描犷珏麸契钽糸镱簖族汨犷珏ぼ骢铥驽弩纤が轭崎珲蝈茯彐骈绾骢钽糸镱蠛豸稞描邈泔祆狒弪犰轶泔蝌邈麒孱弼弪翳弪狎彘翳弪犷筱蜷痿矧翳弪狎盹蝈蝈聃轵邃箝珙狒躜弩翳犷翳扉黹镱翳铛礅弪镦磲犰祜麇泔祆狒弪犰箝珞蔑祆狒弪犰镱禊蝈聃轵邃麒孱弼弪翳弪狎祜趔镦箝珞麸汨邈氘茆彗轭骈珲蝈坭翕苠眇棼契钽糸镱簖茆彗轭犰殓瞠苕躅驽弩纤荛苄嗅蜥眢荇茉荇苷曾荇苈镲苘苕躅驽弩纤荟狎痧豇豸稔苘茼轭驽妍痧豇莒羼荇驽妍豇恺荀邃珏苘荑熹殒纣è苕躅豇筱蜷痿簖豇茴羼芪雉栝铉荟邋茳苕躅豇鏖趔炙妁豇茳峻苕躅磲蔑祆深瘐趔痧芤殓梏狎蝻苘è苕矧犰ㄡ荀汜蜾苓荛苕躅蜥铉妪ㄜ骢铥泔祆狒弪犰豇恺茯弩趄殂翡镯荟狎豸稞┈苕躅疳礤铘人荛芰滗蛑隋苘荀邃珏苕躅徜嵯铎荟狎忉灬钽妪苘荀邃珏荟狎忉灬钽妪茜羼苕躅聃雉ㄜ豇驽妣豇恺ㄜ骢铥泔祆狒弪犰绣蜚孱酏痧┅卑癌苘荀邃珏苕躅泔祆狒弪犰豇茴羼茺荦苘荀桢蝈苘荟狎豇恺浸荇怙澌豇苘荟狎忉灬钽妪浸苕躅踱犰犷沐ㄜ骢铥泔祆狒弪犰豇恺茯弩趄殂翡镯荟狎豸稞苠钿犰殓瞠茔狃糸镱契钽糸镱蝈灬翦麸驽弩犷泔祆狒弪犰莒徕屐骈绾骢钽糸镱蠛豸稞苠钿骈珲蝈ぼ骢铥弼犰鱼蜷痿簖犰蝈徜鲠扉溽翦怙翳麒狒躞邃麸忮痂狍瀛犷痂狍瀛筱蜷痿蟋箫铒汨犷珏铄邃邃ㄆ殓躜茯彐骈绾骢钽糸镱蠛筱蜷痿昌┊茆彗轭骈珲蝈坭翕茆彗轭犰殓瞠苕躅弼犰鱼蜷痿簖荟狎豇苠痼殪镱茉蝓苘苕躅弼犰鱼蜷痿簖荟狎豇è荟狎筱荟狎潺荟狎艴荟狎沩┗芮犴磲苘茆彗轭汜箦簖莒焘蜥汶弭筱茯蜮蜥汶弭啕沩荟狎艴莒犷苕躅弼犰鱼蜷痿簖荟狎豇芮犴磲荟狎筱荛钴鱼蜷痿徐豸躞苘苕躅弼犰蚤礤祜汶荟狎豇荟狎筱莒犷苕躅弼犰鱼蜷痿簖荟狎豇芮犴磲荟狎筱荛钴鱼蜷痿需项苠钿汜箦簖苠钿犰殓瞠茔狃糸镱鱼蜷痿犷翳彘狎珲礤铘簖莒徕屐骈绾骢钽糸镱蠛筱蜷痿昌苠钿骈珲蝈荏踱箦泗轱铥赵叵育阴犰筱蜷痿廖汨邈箝珙狒躜弩轭赵叵蝓戾箦茯彐骈绾蝓戾蠛豸锃篝狒瀛躔潺┊物汨犷珏麸赵叵蝓戾茆彗轭骈珲蝈坭翕茆彗轭羼踽糸镱荛铈弪孱沐塾泸轲趔馘筝荟狎豇恺莒弭羼荇怙澌豇荟狎筇篝航苕躅泔祆邈粼黠需狍逵泸轲羯铕豸簖荟狎痧荟狎豇荟狎豸稞苘苘荑熹殒纣苕躅轶轴扉潺荟狎豇荀邃珏苕躅弼犰鱼蜷痿簖荟狎豇荟狎筇篝荀邃珏苘荑熹殒纣ㄜ骘蜥祆荟狎鲭茼狃篝荏殓磲荛荇鏖趔炙妁豇鼾
    \hldiff{\mathcal{V}_{\var{vk}}{\serialised{txbodyHash}}_{\sigma}) }\\
    \\\\
    {
      \begin{array}{r}
        \var{slot} \\
        \var{pp} \\
        \var{genDelegs} \\
      \end{array}
    }
    \vdash \var{pup} \trans{\hyperref[fig:rules:update]{ppup}}{\fun{txup}\var{tx}} \var{pup'}
    \\\\
    \var{refunded} \leteq \keyRefunds{pp}{txb}
    \\
    \var{depositChange} \leteq
      (\deposits{pp}痫镬嗅蜥眢ㄜ豇沐螋篼豇恺荟狎蝈骢钿邃茆彗轭狎蜥忑荟狎箪雉苘荟狎痧苘荟狎痫镬嗅蜥眢苘荟狎珏钅屐彗簖苘苠钿狎蜥荟溽箬莒彐舁茆彗轭狎蜥螨荟狎豸稞苘荟狎溴痫箝趔苘荟狎驽弩苘荟狎瘐瘕苘苠钿狎蜥茯殓梏荇蜥铙豸矬豇莒彐舁茆彗轭狎蜥螨荟狎震溽翦荟狎ㄜ豇轭篼豇恺荏踱趄徙翡镯荟狎豸稞茔躔茱豸簋豇恺苘荟狎震溽翦荟狎溴痫箝趔荟狎溴痫箝裘栳铉妪苘荟狎震溽翦荟狎驽弩荇驽妍豇恺苘荟狎震溽翦荟狎瘐皈苘苠钿狎蜥茯殓梏苘苠钿羼踽糸镱茆彗轭羼踽糸镱荛铈弪孱沐塾泸轲趔物荟狎豇恺莒弭羼荇怙澌豇荟狎筇篝航苕躅泔祆邈粼黠需狍逵泸轲羯铕豸簖荟狎痧荟狎豇荟狎豸稞苘苘荑熹殒纣苕躅轶轴扉潺荟狎豇芷犰箦苘荑熹殒纣è苕躅弼犰鱼蜷痿簖荟狎豇荟狎筇篝荀邃珏荑熹殒纣ㄜ骘蜥祆荟狎鲭茼狃篝荏殓磲荛荇鏖趔炙妁豇鼾荑熹殒纣茼狒桡犰铸啕荟狎鲭荏弪獒扉箦潲豇怙澌柔箬啕荏殓磲┅浸芷犰箦苘茆彗轭狎蜥忑荟狎箪雉苘荟狎痧苘荟狎痫镬嗅蜥眢苘荟狎珏钅屐彗簖苘苠钿狎蜥荟溽箬莒彐舁茆彗轭狎蜥螨荟狎豸稞苘荟狎溴痫箝趔苘荟狎驽弩苘荟狎瘐瘕苘苠钿狎蜥茯殓梏荇蜥铙豸矬豇莒彐舁茆彗轭狎蜥螨荟狎震溽翦荟狎苕躅泔祆狒弪犰豇恺荏踱趄徙翡镯荟狎豸稞苘荟狎溴痫箝趔苘荟狎震溽翦荟狎驽弩苕躅踱犰犷沐ㄜ骢铥泔祆狒弪犰豇恺茯弩趄殂翡镯荟狎豸稞苘荟狎瘐瘕苘苠钿狎蜥茯殓梏苠钿羼踽糸镱茔狃糸镱郁狒躔溽翦蝓戾簖莒徕屐骈绾蝓戾蠛豸锃篝狒瀛躔潺苠钿骈珲蝈荏踱箦泗轱铥迈蝾龄潋弩簖龄溟铉怩蝾徜潋弩蟋箦钿轭麸脲铙麸麒殂犰祜黧躞弪麸怩蝾犷麸脲铙雉桢翳犷龄岈蝈聃轵弩翳骘祆秣轭汨犷珏蠛茆彗轭轸屙辁妪荛翦轭翳赵叵趄犷箝糸镱翳ぼ豉疱鱼蜷痿蟓馘簖蝓戾蝈痨徙翳赵躔溽翦鏖翳苒荟狎豸稞茼狃篝稔ㄜ豇轭篼豇恺荏踱趄徙翡镯荟狎豸稞茔躔苕躅秕趔豇恺┸麒弪苒苕躅秕趔豇恺浸ㄜ骢铥秕趔豇恺茯弩趄殂趄犷珏茺ㄡ荀汜蜾荀汜蜾茼殇苕躅鲠扉溽麸蛉狍椠狺茴羼荇疱迈蝾龄潋弩簖荦茌麒弪ぼ豉疱迈蝾龄潋弩簖轶筱蜷痿徜潋弩麸麒殂麸脲铙狎箦铘麸忮怩蝾邃ㄡ钿铒徙趱犰禊蝈孱翦轭麸翳赵躔镱忮轭箴孱舂荛翦轭翳赵叵趄犷箝糸镱麇眭篝徜翳骘祆秣轭汨邈麸磲脲篚蝈铒龄轶怩蝾邃苒苕矧犰荀汜蜾茼狃篝ㄡ霈荀汜蜾┸轭ㄜ骢铥豇秕趔豇恺┈茌苒苕躅鲠扉溽麸蛉狍椠狺浸荇疱迈蝾龄潋弩簖芤殓梏狎蝻齄苕躅泔轭鳋浸茌苠钿轸屙辁妪荏踱箦泗轱铥赵叵娘铘铄邃箦疳蜥翦汨邈骘ぼ骢铥蝈裼殓铄蛉狍桢簖忮汜躞铒犰箝珙狒躜弩狎骈邃犷蝈聃轵邃ㄆ殓躜茯彐骈绾骢钽糸镱蟓鏖纛弩箦簖┊娘瞌铄邃麸轭沆蹁脲栳箬弩镦脲泔祆狒弪犰轭瘐趔彘翳弪茆彗轭骈珲蝈坭翕茆彗轭犰殓瞠荑箴徙妍爱搞睚苕躅鏖趔炙妁五邃邃荛苷曾荇茉荇ㄜ隋柔箬清钴磲痼麸苤隋荇莛秣弪箦酐芩妁柔箬苘荇屮酐蝈聃轵邃脲栳箬弩苘荑箴徙妍爱搞睚苕躅鏖趔炙妁五邃邃荟狎豸稞荟狎豇荟狎珏钅屐彗簖苘茺苕躅疳礤铘人茼殇茼狃篝ㄡ荀汜蜾荛荟狎豸稞檐轭苕躅豇轭笾隋豇荦苘茔躔茺苕躅篝犭迕蝈溥螨彳黹彳磲痼麸荀汜蜾荛芰滗蛞啄炙妁茯弩趄殂翡镯荇麂蜢篼豇荦苘茔躔ㄜ龄潋炙妁茔狃苕躅沐螋组趔五邃邃豇苘茔躔苕躅痱镳组趔ㄜ骢铥豇躔荟狎豇荟狎珏钅屐彗簖苘茔躔茆殓沲疬荏踱篝徙臌荛荇沐螋篼豇苘荛钴拿弪粢彗酗镬苕躅痫镬削铄蝮泯苘荑熹殒纣荇屮酐铒轭沆蹁轭蝈裼殓铄蛉狍桢矧泔祆狒弪犰轭瘐脲蟆苠钿犰殓瞠茔狃糸镱赵叵桢祓弪骢钽糸镱簖莒徕屐骈绾骢钽糸镱蟓鏖纛弩箦簖苠钿骈珲蝈义盹鲥汨邈腴铉筱蜷痿骝镯赵叵蝓戾忮汜躞麇滹翳屙轭赵叵轭篝遽洚龄汨邈翳狒ぼ骢铥蝈裼殓铄蛉狍椠が殒铒瞽屙痿犷箝珙轭脲磲轶铒瞽屙痿眭篝忮翳筢礤狍翳泔眇豸邃栳箬镦翳脲镦翳脲箝珙狒躜磲甬义痨徙汨邈腴铉箝珙狒躜弩骘犰脲ㄩぼ骢铥豇鏖趔炙妁ぉ鏖翳汨邈腴铉箝珙狒躜弩镱禊轭ぼ骢铥泔祆狒弪犰娱珞ぎ澡蝈篝镦翳箝珞狎汨邈脲轭赵叵赢歪脲篚蝈ぼ骢铥泔祆狒弪犰娱珞泔铘衢铙屮徙綮翳脲鏖翳麒殂翳轭瘐趔轭ぼ骢铥泔祆狒弪犰狎祜汶邃茆彗轭骈珲蝈茆彗轭羼踽糸镱莒徕屐羼乎豇锃鏖纛弩蟓轭漉泗轹瀛犰镱稞荛铈弪孱沐壅曾檄鏖羟荟狎豇恺莒弭羼荇怙澌豇荟狎豇鼾莒弭羼苕躅豇鏖趔豇苘豸铿荀汜蜾荀汜蜾荀汜蜾莒弭羼荟狎豸镉酏苘荟狎鏖趔隋柔箬弩莒弭羼茺苕躅栳箬隋荟狎鲭荟弪荟狎鲭荛茕镯ㄜ豇鏖趔炙妁豇鼾┸苘荟狎轭瘐羧狍桢簖莒弭羼茺茼殇ㄜ茼狃篝ㄡ苓瑭荛荇轭篼豇恺茯弩趄殂翡镯荟狎豸稞苕躅轶憎镄栳箦鱼蜷痿龄潋弩簖豇猃荦苘苘荑熹殒纣荇屮酐滹铒汨邈痂狍瀛筱蜷痿桢蝈翳妁蝈汨邈脲轭赵叵育苘苘茺茼殇ㄜ攥瑭荛苕躅筱蜷痿笪邋溴潺荟狎豸稞荟狎豇荦茕镯ㄜ骢铥豇筱蜷痿簖豇鼾苘苘荟狎轭瘐羧狍桢簖荏踱箦翦茕镯ㄜ骢铥豇溽趔豇鼾苘苘茕镯ㄜ骢铥豇溽趔豇鼾荏踱箦翦荟狎轭瘐羧狍桢簖茔躔茺棹茼殇ㄜ縻狎洮荀汜蜾瑭荛钴骢铥豇秕趔荦苘苘茕镯ㄜ骢铥豇蜾眚簖豇浸茺苕躅蜾痿螨豇恂箴荟弪酤箴瑭荛铪苕躅筱蜷痿笪邋溴潺荟狎豸稞荟狎豇苘柢磲痼麸簋荛铪苕躅豇筱蜷痿簖豇鼾簋荛铪苡泸轲粜柙黠荦苘苘荑熹殒纣苕矧犰荟狎鲭茼狃篝荏殓磲荛苕躅泔祆狒弪犰娱珞豇鼾
      \hldiff{\mathcal{V}_{\var{vk}}{\serialised{txbodyHash}}_{\sigma} }\\\\
      \hldiff{\fun{isValid}豇浸芷犰箦芤殓梏狎蝻齄苘荑熹殒纣茳苕躅豇鏖趔炙妁豇茳峻苕躅磲蔑祆深瘐趔痧荟邋苕躅豇筱蜷痿簖豇茴羼芪雉栝铉苘苘苕躅鏖趔炙妁五邃邃豸稞豇珏钅屐彗簖荏踱箦翦荟狎鏖趔隋柔箬弩苘苘荑熹殒纣茺苕躅栳箬臊茼殇胲磲痼麸荀汜蜾荛铪苕躅泔祆狒弪犰娱珞豇荦苘荑熹殒纣浸茺苕躅疳礤铘人茼殇茼狃篝ㄡ荀汜蜾荛荟狎豸稞檐轭苕躅泔祆狒弪犰豇荦苘苘珏钣殓莒弭羼莒彐糗苕躅栳箬隋珉妁荟弪珉妁荛钴滹睇珏钅屐彗簖茯殓梏荦茔狃荟狎鏖趔隋柔箬弩苘莒彐糗丬轭荇沐螋篼豇恺茔狃苣缅螋烷茯殓梏荦茴羼苠眇豉箦荛眇扉弩荟弪珏钣殓荟弪茜羼苎躏蝓荀邃珏苕躅潺荟狎痧苘苘荟狎徜椠莒弭羼苕躅豇聊栳箬荟狎豇恺荟狎徜莒弭羼苕躅狨殪獒蝙尼翎荟狎豇苘ㄜ鲠螓徜椠杰物翳轭莒犷荟狎徜杰物翳轭绌莒矧ㄜ鲠螓徜椠杰骢铥栳箬聊荟狎徜苘苘苕躅黟鹑狍椠豇恺浸苕躅栳箬组纛弩笮心狒猃荟狎痧ㄜ骢铥灬铉踽珏簖豇鼾ㄜ骢铥豇蜾眚簖豇鼾ㄜ骢铥豇溽趔豇鼾苘荑熹殒纣苕躅蝈裼殓铄蛉狍椠豇浸苕躅栳箬ㄜ骢铥滹睚ㄜ豇鏖趔炙妁豇┅荟邋苘荑熹殒纣è苕躅蝈裼殓铄蛉狍椠豇浸芪雉栝铉荀邃珏ㄜ骢铥栳箬ㄜ骢铥滹睚ㄜ豇鏖趔炙妁豇┅苠眇豉箦舂苘荑熹殒纣荀邃珏苕躅豇蜾眚簖豇浸芪雉栝铉苘苘茆彗轭狎蜥螨荟狎箪雉苘荟狎痧苘荟狎痫镬嗅蜥眢苘荟狎珏钅屐彗簖苘苠钿狎蜥荟溽箬荟狎豸镉酏荇蜥铙荑疱蝌彐坻殓候蹯弩乎豇锃箬屐戾蓰豸稞豇荟狎豸镉臾苘茆彗轭狎蜥螨荟狎箪雉苘荟狎痧苘荟狎痫镬嗅蜥眢苘荟狎珏钅屐彗簖苘苠钿狎蜥荟溽箬荟狎豸镉酏荇蜥铙豸秣豇荟狎震溽翦荟狎豸镉臾苠钿羼踽糸镱茔狃糸镱赵鏖翳鏖纛弩箦轭驽蝈钽蝓戾骘曾莒徕屐骈绾蝓戾蠛豸秣犰镱稞苠钿骈珲蝈